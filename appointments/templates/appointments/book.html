{% extends "base.html" %}

{% block title %}Book Appointment - {{ block.super }}{% endblock %}

{% block header %}Book an Appointment{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <!-- Page Header -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg p-6 mb-8">
    <div class="flex items-center text-white">
      <i class="fa-solid fa-calendar-plus text-3xl mr-4"></i>
      <div>
        <h1 class="text-2xl font-bold">Schedule Your Appointment</h1>
        <p class="text-blue-100 mt-1">Book a consultation with our healthcare professionals</p>
      </div>
    </div>
  </div>

  <!-- Main Form Container -->
  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <form method="post" id="appointmentForm" class="p-8 space-y-8">
      {% csrf_token %}

      <!-- Doctor Selection Section -->
      <div class="space-y-4">
        <div class="flex items-center mb-4">
          <i class="fa-solid fa-user-doctor text-blue-600 text-xl mr-3"></i>
          <h2 class="text-lg font-semibold text-gray-800">Select Healthcare Provider</h2>
        </div>
        
        <div class="space-y-2">
          <label for="doctor" class="block text-sm font-medium text-gray-700">
            Choose your preferred doctor
          </label>
          <select name="doctor" id="doctor" required 
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white">
            <option value="" disabled selected>Select a doctor...</option>
            {% for doc in doctors %}
            <option value="{{ doc.id }}" data-specialty="{{ doc.specialization }}">
              {{ doc.first_name|default:doc.username }} {{ doc.last_name }} - {{ doc.specialization }}
            </option>
            {% empty %}
            <option disabled>No doctors available</option>
            {% endfor %}
          </select>
        </div>

        <!-- Doctor Info Card (Dynamic) -->
        <div id="doctorInfo" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 transition-all duration-300">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center">
              <i class="fa-solid fa-user-doctor text-blue-600"></i>
            </div>
            <div class="flex-1">
              <h3 id="selectedDoctorName" class="font-semibold text-gray-800"></h3>
              <p id="selectedDoctorSpecialty" class="text-sm text-gray-600"></p>
              <div class="flex items-center mt-1 text-xs text-gray-500">
                <i class="fa-solid fa-clock mr-1"></i>
                <span>Available: Monday - Friday, 9:00 AM - 5:00 PM</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Date & Time Section -->
      <div class="space-y-4">
        <div class="flex items-center mb-4">
          <i class="fa-solid fa-calendar-days text-blue-600 text-xl mr-3"></i>
          <h2 class="text-lg font-semibold text-gray-800">Select Date & Time</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Date Selection -->
          <div class="space-y-2">
            <label for="date" class="block text-sm font-medium text-gray-700">
              <i class="fa-solid fa-calendar-day mr-2 text-blue-600"></i>
              Appointment Date
            </label>
            <input type="date" name="date" id="date" required 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
          </div>

          <!-- Time Selection -->
          <div class="space-y-2">
            <label for="time" class="block text-sm font-medium text-gray-700">
              <i class="fa-solid fa-clock mr-2 text-blue-600"></i>
              Preferred Time
            </label>
            <select name="time" id="time" required 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white">
              <option value="" disabled selected>Choose time slot...</option>
              <option value="09:00">9:00 AM</option>
              <option value="09:30">9:30 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="10:30">10:30 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="11:30">11:30 AM</option>
              <option value="14:00">2:00 PM</option>
              <option value="14:30">2:30 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="15:30">3:30 PM</option>
              <option value="16:00">4:00 PM</option>
              <option value="16:30">4:30 PM</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Appointment Details Section -->
      <div class="space-y-4">
        <div class="flex items-center mb-4">
          <i class="fa-solid fa-clipboard-list text-blue-600 text-xl mr-3"></i>
          <h2 class="text-lg font-semibold text-gray-800">Appointment Details</h2>
        </div>

        <!-- Appointment Type -->
        <div class="space-y-3">
          <label class="block text-sm font-medium text-gray-700">
            Type of Appointment
          </label>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-all">
              <input type="radio" name="appointment_type" value="consultation" required class="mr-3 text-blue-600 focus:ring-blue-500">
              <div class="flex items-center">
                <i class="fa-solid fa-comments text-blue-600 mr-2"></i>
                <div>
                  <div class="font-medium text-gray-800">Consultation</div>
                  <div class="text-sm text-gray-500">Initial checkup</div>
                </div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-all">
              <input type="radio" name="appointment_type" value="follow_up" required class="mr-3 text-blue-600 focus:ring-blue-500">
              <div class="flex items-center">
                <i class="fa-solid fa-arrow-rotate-right text-blue-600 mr-2"></i>
                <div>
                  <div class="font-medium text-gray-800">Follow-up</div>
                  <div class="text-sm text-gray-500">Return visit</div>
                </div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-all">
              <input type="radio" name="appointment_type" value="emergency" required class="mr-3 text-blue-600 focus:ring-blue-500">
              <div class="flex items-center">
                <i class="fa-solid fa-triangle-exclamation text-red-600 mr-2"></i>
                <div>
                  <div class="font-medium text-gray-800">Urgent</div>
                  <div class="text-sm text-gray-500">Priority care</div>
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Symptoms/Reason -->
        <div class="space-y-2">
          <label for="symptoms" class="block text-sm font-medium text-gray-700">
            <i class="fa-solid fa-notes-medical mr-2 text-blue-600"></i>
            Reason for Visit (Optional)
          </label>
          <textarea name="symptoms" id="symptoms" rows="3" 
                    placeholder="Please briefly describe your symptoms or reason for the appointment..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none"></textarea>
        </div>
      </div>

      <!-- Contact Information Section -->
      <div class="space-y-4">
        <div class="flex items-center mb-4">
          <i class="fa-solid fa-address-card text-blue-600 text-xl mr-3"></i>
          <h2 class="text-lg font-semibold text-gray-800">Contact Information</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="phone" class="block text-sm font-medium text-gray-700">
              <i class="fa-solid fa-phone mr-2 text-blue-600"></i>
              Phone Number
            </label>
            <input type="tel" name="phone" id="phone" 
                   placeholder="Enter 10-digit phone number"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
          </div>
          <div class="space-y-2">
            <label for="email" class="block text-sm font-medium text-gray-700">
              <i class="fa-solid fa-envelope mr-2 text-blue-600"></i>
              Email Address (Optional)
            </label>
            <input type="email" name="email" id="email" 
                   placeholder="your.email@example.com"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
        <button type="button" onclick="window.history.back()" 
                class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center">
          <i class="fa-solid fa-arrow-left mr-2"></i>
          Back
        </button>
        <button type="submit" 
                class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 flex items-center justify-center shadow-lg">
          <i class="fa-solid fa-calendar-check mr-2"></i>
          Book Appointment
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Success Message (if needed) -->
{% if messages %}
<div class="fixed top-4 right-4 z-50">
  {% for message in messages %}
  <div class="bg-green-100 border border-green-400 text-green-700 px-6 py-4 rounded-lg shadow-lg mb-2 flex items-center">
    <i class="fa-solid fa-check-circle mr-2"></i>
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<script>
// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').setAttribute('min', today);
});

// Show doctor information when selected
document.getElementById('doctor').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const doctorInfo = document.getElementById('doctorInfo');
    const doctorName = document.getElementById('selectedDoctorName');
    const doctorSpecialty = document.getElementById('selectedDoctorSpecialty');

    if (this.value && selectedOption.text !== 'Select a doctor...') {
        const doctorText = selectedOption.text;
        const parts = doctorText.split(' - ');
        
        doctorName.textContent = parts[0] || 'Doctor';
        doctorSpecialty.textContent = parts[1] || 'General Practice';
        
        doctorInfo.classList.remove('hidden');
        doctorInfo.classList.add('animate-fade-in');
    } else {
        doctorInfo.classList.add('hidden');
    }
});

// Phone number formatting for Indian numbers
{% comment %} document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // keep only digits
    
    // If the user already started with "91" (common mistake), trim it
    if (value.startsWith('91') && value.length > 10) {
        value = value.substring(2);
    }
    
    // Limit to 10 digits
    if (value.length > 10) {
        value = value.substring(0, 10);
    }
    
    // Format as +91 XXXXX XXXXX
    if (value.length > 5) {
        e.target.value = '+91 ' + value.substring(0, 5) + ' ' + value.substring(5);
    } else if (value.length > 0) {
        e.target.value = '+91 ' + value;
    } else {
        e.target.value = '';
    }
}); {% endcomment %}

// Form validation enhancement
document.getElementById('appointmentForm').addEventListener('submit', function(e) {
    const phone = document.getElementById('phone').value.replace(/\D/g, ''); 
    
    if (phone.length !== 10) {
        e.preventDefault();
        alert('Please enter a valid 10-digit phone number.');
        return false;
    }
});

// Add smooth transitions
document.head.insertAdjacentHTML('beforeend', `
<style>
.animate-fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

input[type="radio"]:checked + div {
    background-color: rgba(59, 130, 246, 0.1);
}

.transition-all {
    transition: all 0.2s ease-in-out;
}
</style>
`);
</script>
{% endblock %}